const n=_,o='k3rn-dropdown-active',e='k3rn-dropdown-global',t='k3rn-dropdown-overhaul',r='k3rn-dropdown-overhaul',a=`\n  #${e} {\n      margin: 0;\n      position: fixed;\n      z-index: 99999;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.4);\n      max-height: 400px;\n      display: flex;\n      flex-direction: column;\n      background: var(--SmartThemeBlurTintColor, #1a1a1a);\n      color: var(--SmartThemeBodyColor, #eee);\n      border: 1px solid var(--SmartThemeBorderColor, #444);\n      border-radius: 4px;\n\n      overflow: hidden;\n      backdrop-filter: blur(8px);\n      -webkit-backdrop-filter: blur(8px);\n  }\n\n  #${e} .search-wrapper {\n      padding: 8px;\n      background: rgba(0, 0, 0, 0.2);\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n      flex-shrink: 0;\n  }\n\n  #${e} .search-input {\n      width: 100%;\n      padding: 6px 8px;\n      border-radius: 4px;\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      background: rgba(0, 0, 0, 0.3);\n      color: inherit;\n      outline: none;\n      font-size: 0.9em;\n  }\n  #${e} .search-input:focus {\n      border-color: var(--SmartThemeQuoteColor, #888);\n      background: rgba(0, 0, 0, 0.5);\n  }\n\n  #${e} .options-list {\n      overflow-y: auto;\n      flex-grow: 1;\n      max-height: 300px;\n  }\n\n  #${e} .options-list::-webkit-scrollbar {\n      width: 6px;\n  }\n  #${e} .options-list::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 3px;\n  }\n\n  #${e} .option-item {\n      padding: 8px 12px;\n      cursor: pointer;\n      transition: background 0.1s;\n  }\n  #${e} .option-item:hover {\n      background: rgba(128,128,128,0.1);\n  }\n  #${e} .option-item.selected {\n      background: rgba(128,128,128,0.2);\n      font-weight: bold;\n      border-left: 3px solid var(--SmartThemeQuoteColor, #888);\n  }\n  #${e} .no-results {\n      padding: 12px;\n      text-align: center;\n      color: var(--SmartThemeBodyColor, #eee);\n      font-style: italic;\n      display: none;\n  }\n  #${e} .optgroup-header {\n      padding: 3px 12px;\n      font-size: 0.8em;\n      color: var(--SmartThemeQuoteColor, #888);\n      pointer-events: none;\n      background: rgba(128, 128, 128, 0.2);\n  }\n  #${e} .option-item.grouped {\n      padding-left: 24px;\n  }\n`,s=()=>{const n=$(`.${o}`);n.length&&(n.parents().add(document).off('.k3rn-dropdown-scroll'),n.removeClass(o)),$(`#${e}`).remove()},i=t=>{t.addClass(o);t.parents().add(document).on(`scroll.${r}`,()=>{s()});const a=[];let i=0;const d=(n,o)=>{if('none'===n.css('display'))return;i++;const e=n.text(),r=n.is(':selected'),d=$(`<div class="option-item ${o?'grouped':''} ${r?'selected':''}">${e}</div>`);d.data('type','option'),d.data('search-text',e.toLowerCase()),o&&d.data('group-header',o),d.on('click',o=>{o.stopPropagation();const e=n.val()??'undefined',r=t[0];r.value=e.toString(),r.dispatchEvent(new Event('change',{bubbles:!0})),r.dispatchEvent(new Event('input',{bubbles:!0})),t.trigger('change'),n.trigger('click'),s()}),d.on('mousedown touchstart touchend',n=>n.stopPropagation()),a.push(d)};t.children().each((_,n)=>{const o=$(n);if('optgroup'===n.tagName.toLowerCase()){const n=o.attr('label')||'',e=$(`<div class="optgroup-header">${n}</div>`);e.data('type','optgroup'),a.push(e);const t=i;return o.children('option').each((_,n)=>d($(n),e)),void(i===t&&a.pop())}d(o)});const p=i>7,l=$(`<div id="${e}"></div>`),c=$('<div class="options-list"></div>'),u=$('<div class="no-results">无结果</div>');if(p){const o=$('<div class="search-wrapper"><input type="text" class="search-input" placeholder="搜索…" /></div>'),e=o.find('input');e.on('input',(0,n.debounce)(n=>{const o=n.target.value.toLowerCase().trim();let e=!1;a.forEach(n=>{if('optgroup'===n.data('type'))return void n.css('display',o?'none':'');const t=n.data('search-text');if(!o||t.includes(o)){if(n.css('display',''),e=!0,o){const o=n.data('group-header');o&&o.css('display','')}}else n.css('display','none')}),e?u.hide():u.show()},200)),e.on('mousedown click touchstart touchend',n=>n.stopPropagation()),l.append(o),setTimeout(()=>{Math.min(window.screen.width,window.outerWidth)<=500||(e[0].focus(),e.trigger('focus'))},6)}c.append(a).append(u),l.append(c);const h=t.closest('dialog');h.length?h.append(l):$('body').append(l);const g=t[0].getBoundingClientRect(),b=$(window).scrollTop()||0,m=$(window).scrollLeft()||0;let w=0;if(($(window).height()||0)-g.bottom<350&&g.top>350){const n=l.outerHeight()??300;w=g.top+b-n-4}else w=g.bottom+b+4;const f=Math.max(4,g.left+m);l.css({top:w+'px',left:f+'px',minWidth:Math.max(g.width,200)+'px'}),setTimeout(()=>{const n=c.find('.selected');n.length&&c.scrollTop(n[0].offsetTop-c.height()/2)},7)},d=n=>{if(0!==n.button)return;const e=n.currentTarget,t=$(e);n.preventDefault(),n.stopPropagation();t.hasClass(o)?s():(s(),i(t))};$(()=>{$(`#${t}`).remove(),$(`<style id="${t}">${a}</style>`).appendTo('head');const n=window.parent.document||document;$(n).on(`mousedown.${r}`,'select',d),$(n).on(`click.${r}`,'select',n=>{n.preventDefault()}),$(n).on(`keydown.${r}`,'select',function(n){const e=$(this);if(' '===n.key||'Enter'===n.key){n.preventDefault(),n.stopPropagation();const t=e.hasClass(o);s(),t||i(e)}}),$(n).on(`click.${r}`,n=>{n.target&&(n.target.closest('select')?.length||s())})}),$(window).on('pagehide',()=>{const n=window.parent.document||document;s(),$(`#${t}`).remove(),$(n).off(`.${r}`),$(`.${o}`).removeClass(o)});
//# sourceMappingURL=index.js.map