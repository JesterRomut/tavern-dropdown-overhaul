const n=_,o='k3rn-replaced',e='k3rn-trigger-active',t='k3rn-global-dropdown',r='k3rn-select-style',s='k3rn-select-scroll',a=`\n  #${t} {\n      position: absolute;\n      z-index: 99999;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.4);\n      /* 整体最大高度，包含搜索栏 */\n      max-height: 400px;\n      display: flex;\n      flex-direction: column;\n      background: var(--SmartThemeBorderColor, #1a1a1a);\n      color: var(--SmartThemeTextColor, #eee);\n      border: 1px solid var(--SmartThemeBorderColor, #444);\n      border-radius: 4px;\n      font-size: 14px;\n      overflow: hidden; /* 防止圆角溢出 */\n  }\n\n  /* 搜索栏容器 - 固定在顶部 */\n  #${t} .search-wrapper {\n      padding: 8px;\n      background: rgba(0, 0, 0, 0.2);\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n      flex-shrink: 0;\n  }\n\n  /* 搜索输入框 */\n  #${t} .search-input {\n      width: 100%;\n      padding: 6px 8px;\n      border-radius: 4px;\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      background: rgba(0, 0, 0, 0.3);\n      color: inherit;\n      outline: none;\n      font-size: 13px;\n  }\n  #${t} .search-input:focus {\n      border-color: var(--SmartThemeQuoteColor, #888);\n      background: rgba(0, 0, 0, 0.5);\n  }\n\n  /* 选项列表容器 - 负责滚动 */\n  #${t} .options-list {\n      overflow-y: auto;\n      flex-grow: 1;\n      max-height: 300px; /* 列表本身的最大高度 */\n  }\n\n  /* 滚动条美化 (针对 Webkit) */\n  #${t} .options-list::-webkit-scrollbar {\n      width: 6px;\n  }\n  #${t} .options-list::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 3px;\n  }\n\n  #${t} .option-item {\n      padding: 8px 12px;\n      cursor: pointer;\n      transition: background 0.1s;\n  }\n  #${t} .option-item:hover {\n      background: rgba(255,255,255,0.1);\n  }\n  #${t} .option-item.selected {\n      background: rgba(255,255,255,0.15);\n      font-weight: bold;\n      border-left: 3px solid var(--SmartThemeQuoteColor, #888);\n  }\n  /* 搜索无结果时的提示 */\n  #${t} .no-results {\n      padding: 12px;\n      text-align: center;\n      color: rgba(255, 255, 255, 0.5);\n      font-style: italic;\n      display: none;\n  }\n`;const i=()=>{$(`#${r}`).remove(),$(`<style id="${r}">${a}</style>`).appendTo('head');const i=()=>{const n=$(`.${e}`);n.length&&(n.parents().add(document).off(`.${s}`),n.removeClass(e)),$(`#${t}`).remove()},d=()=>{$('select').not(`[${o}]`).each(function(){const n=$(this);n.attr(o,'true'),n.on('mousedown',function(o){if(0!==o.button)return;o.preventDefault(),o.stopPropagation(),this.focus();n.hasClass(e)?i():(i(),l(n))}),n.on('keydown',function(o){if(' '===o.key||'Enter'===o.key){o.preventDefault(),o.stopPropagation();const t=n.hasClass(e);i(),t||l(n)}})})},l=o=>{o.addClass(e);o.parents().add(document).on(`scroll.${s}`,()=>{i()});const r=$(`<div id="${t}"></div>`),a=$('<div class="search-wrapper"><input type="text" class="search-input" placeholder="Search..." /></div>'),d=$('<div class="options-list"></div>'),l=$('<div class="no-results">No options found</div>'),c=a.find('input'),p=o.find('option'),u=[];p.each((_,n)=>{const e=$(n);if('none'===e.css('display'))return;const t=e.text(),r=e.is(':selected'),s=$(`<div class="option-item ${r?'selected':''}">${t}</div>`);s.data('search-text',t.toLowerCase()),s.on('click',n=>{n.stopPropagation(),o.val(e.val()??'undefined'),o.trigger('change'),i()}),s.on('mousedown touchstart touchend',n=>n.stopPropagation()),u.push(s)}),d.append(u),d.append(l),r.append(a).append(d),$('body').append(r),c.on('input',(0,n.debounce)(n=>{const o=n.target.value.toLowerCase().trim();let e=!1;u.forEach(n=>{const t=n.data('search-text');!o||t.includes(o)?(n.css('display',''),e=!0):n.css('display','none')}),e?l.hide():l.show()},200)),c.on('mousedown click touchstart touchend',n=>n.stopPropagation());const h=o[0].getBoundingClientRect(),g=$(window).scrollTop()||0,b=$(window).scrollLeft()||0;let f=0;if(($(window).height()||0)-h.bottom<350&&h.top>350){const n=r.outerHeight()??300;f=h.top+g-n-4}else f=h.bottom+g+4;const x=Math.max(4,h.left+b);r.css({top:f+'px',left:x+'px',minWidth:Math.max(h.width,200)+'px'}),setTimeout(()=>{c.trigger('focus');const n=d.find('.selected');n.length&&d.scrollTop(n[0].offsetTop-d.height()/2)},10)};$(document).on('mousedown',n=>{i()}),d();new MutationObserver(n=>{let o=!1;for(const e of n)if(e.addedNodes.length>0){o=!0;break}o&&d()}).observe(document.body,{childList:!0,subtree:!0})};$(()=>{i()});
//# sourceMappingURL=index.js.map